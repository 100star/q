(function(s){"function"===typeof define?define(s):"object"===typeof exports?s(void 0,exports):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=function(){return s(void 0,{})}):s(void 0,Q={})})(function(s,c){function G(a){var b=Error.prepareStackTrace;Error.prepareStackTrace=function(a,b){return b.filter(function(a){a=a.getFileName();return"module.js"!==a&&"node.js"!==a&&a!==H})};a=a.stack;Error.prepareStackTrace=b;return a}function i(){function a(a){if(b)return d=k(a),v(b,function(a,b){l(function(){d.promiseDispatch.apply(d,
b)})},void 0),b=void 0,d}var b=[],d,t=z(i.prototype),c=z(m.prototype);c.promiseDispatch=function(){var a=e(arguments);b?b.push(a):l(function(){d.promiseDispatch.apply(d,a)})};c.valueOf=function(){return b?c:d.valueOf()};Error.captureStackTrace&&Error.captureStackTrace(c,i);q(c);t.promise=c;t.resolve=a;t.reject=function(b){return a(n(b))};return t}function m(a,b,d,c){void 0===b&&(b=function(a){return n(Error("Promise does not support operation: "+a))});var g=z(m.prototype);g.promiseDispatch=function(d,
c,t){try{a[c]?d(a[c].apply(g,t)):d(b.call(g,c,t))}catch(h){d(n(h))}};d&&(g.valueOf=d);c&&(g.exception=c);q(g);return g}function w(a){return Object(a)!==a?a:a.valueOf()}function x(a){return a&&"function"===typeof a.promiseDispatch}function I(a){return!x(w(a))}function J(a){a=w(a);return x(a)&&"exception"in a}function n(a){var a=a||Error(),b=m({when:function(b){if(b){var c=R(A,this);-1!==c&&(B.splice(c,1),A.splice(c,1))}return b?b(a):n(a)}},function(){return n(a)},function(){return this},a);A.push(b);
B.push(a);return b}function k(a){if(x(a))return a;if(a&&"function"===typeof a.then){var b=i();a.then(b.resolve,b.reject);return b.promise}return m({when:function(){return a},get:function(b){return a[b]},put:function(b,c){return a[b]=c},del:function(b){return delete a[b]},post:function(b,c){return a[b].apply(a,c)},apply:function(b){return a.apply(void 0,b)},keys:function(){return S(a)}},void 0,function(){return a})}function f(a,b,d){function c(a){try{return b?b(a):a}catch(d){return n(d)}}function g(a){try{return d?
d(a):n(a)}catch(b){return n(b)}}var f=i(),e=!1;l(function(){k(a).promiseDispatch(function(a){e||(e=!0,k(a).promiseDispatch(function(a){f.resolve(c(a))},"when",[function(a){f.resolve(g(a))}]))},"when",[function(a){e||(e=!0,f.resolve(g(a)))}])});return f.promise}function C(a,b,d){var c=i();l(function(){k(a).promiseDispatch(c.resolve,b,d)});return c.promise}function r(a){return function(b){var d=e(arguments,1);return C(b,a,d)}}function K(a){var b=e(arguments,1);return D(a,b)}function L(a){return f(a,
function(a){var d=a.length;if(0===d)return k(a);var c=i();v(a,function(g,e,i){f(e,function(g){a[i]=g;0===--d&&c.resolve(a)}).fail(c.reject)},void 0);return c.promise})}function y(a,b,d){return M(a,b).apply(void 0,d)}function M(a){if(1<arguments.length)var b=arguments[1],d=e(arguments,2),c=a,a=function(){var a=d.concat(e(arguments));return c.apply(b,a)};return function(){var b=i(),d=e(arguments);d.push(b.makeNodeResolver());D(a,d).fail(b.reject);return b.promise}}var E=function(){},q=Object.freeze||
E;"undefined"!==typeof cajaVM&&(q=cajaVM.def);var l;if("undefined"!==typeof process)l=process.nextTick;else if("function"===typeof msSetImmediate)l=msSetImmediate.bind(window);else if("function"===typeof setImmediate)l=setImmediate;else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,u={},O=u;N.port1.onmessage=function(){u=u.next;var a=u.task;delete u.task;a()};l=function(a){O=O.next={task:a};N.port2.postMessage(0)}}else l=function(a){setTimeout(a,0)};var o;Function.prototype.bind?
(o=Function.prototype.bind,o=o.bind(o.call)):o=function(a){return function(b){return a.call.apply(a,arguments)}};var e=o(Array.prototype.slice),v=o(Array.prototype.reduce||function(a,b){var d=0,c=this.length;if(arguments.length===1){do{if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError;}while(1)}for(;d<c;d++)d in this&&(b=a(b,this[d],d));return b}),R=o(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),P=o(Array.prototype.map||function(a,
b){var d=this,c=[];v(d,function(g,e,f){c.push(a.call(b,e,f,d))},void 0);return c}),z=Object.create||function(a){function b(){}b.prototype=a;return new b},S=Object.keys||function(a){var b=[],c;for(c in a)b.push(c);return b},T=Object.prototype.toString,F;F="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};var H;Error.captureStackTrace&&(H=function(){var a,b=Error.prepareStackTrace;Error.prepareStackTrace=function(b,c){a=c[0].getFileName()};Error().stack;Error.prepareStackTrace=
b;return a}());c.nextTick=l;c.defer=i;i.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(e(arguments,1)):a.resolve(c)}};c.promise=function(a){var b=i();call(a,void 0,b.resolve,b.reject).fail(b.reject);return b.promise};c.makePromise=m;m.prototype.then=function(a,b){return f(this,a,b)};v("isResolved,isFulfilled,isRejected,dispatch,when,spread,get,put,del,post,invoke,keys,fapply,fcall,fbind,all,allResolved,timeout,delay,catch,finally,fail,fin,end".split(","),
function(a,b){m.prototype[b]=function(){return c[b].apply(c,[this].concat(e(arguments)))}},void 0);m.prototype.toSource=function(){return this.toString()};m.prototype.toString=function(){return"[object Promise]"};q(m.prototype);c.nearer=w;c.isPromise=x;c.isResolved=function(a){return I(a)||J(a)};c.isFulfilled=I;c.isRejected=J;var A=[],B=[];"undefined"!==typeof window&&window.console&&console.log("Should be empty:",B);c.reject=n;c.begin=k;c.resolve=k;c.master=function(a){return m({isDef:function(){}},
function(b,c){return C(a,b,c)},function(){return w(a)})};c.when=f;c.spread=function(a,b,c){return f(a,function(a){return b.apply(void 0,a)},c)};c.async=function(a){return function(){function b(a,b){var i;try{i=c[a](b)}catch(h){return T(h)==="[object StopIteration]"||h instanceof F?h.value:n(h)}return f(i,e,g)}var c=a.apply(this,arguments),e=b.bind(b,"send"),g=b.bind(b,"throw");return e()}};c["return"]=function(a){throw new F(a);};c.dispatch=C;c.dispatcher=r;c.get=r("get");c.put=r("put");c["delete"]=
c.del=r("del");var U=c.post=r("post");c.invoke=function(a,b){var c=e(arguments,2);return U(a,b,c)};var D=c.fapply=r("apply");c["try"]=K;c.fcall=K;c.fbind=function(a){var b=e(arguments,1);return function(){var c=b.concat(e(arguments));return D(a,c)}};c.keys=r("keys");c.all=L;c.allResolved=function(a){return f(a,function(a){return f(L(P(a,function(a){return f(a,E,E)})),function(){return P(a,k)})})};c["catch"]=c.fail=function(a,b){return f(a,void 0,b)};c["finally"]=c.fin=function(a,b){return f(a,function(a){return f(b(),
function(){return a})},function(a){return f(b(),function(){return n(a)})})};c.end=function(a){f(a,void 0,function(b){l(function(){if(Error.captureStackTrace){var c=G(b),e=G(a),c=c.concat("From previous event:",e),g,e=[];try{e.push(b.toString())}catch(f){try{e.push("<error: "+f+">")}catch(i){e.push("<error>")}}for(var l=0;l<c.length;l++){var h=c[l];if(typeof h==="string")e.push(h);else{try{var p="";if(h.isNative())p="native";else if(h.isEval())p="eval at "+h.getEvalOrigin();else{var m=h.getFileName();
if(m){var p=p+m,n=h.getLineNumber();if(n!==null){var p=p+(":"+n),o=h.getColumnNumber();o&&(p=p+(":"+o))}}}p||(p="unknown source");var j="",k=h.getFunction().name,r=true,s=h.isConstructor();if(!h.isToplevel()&&!s){var q=h.getMethodName(),j=j+(h.getTypeName()+".");if(k){j=j+k;q&&q!==k&&(j=j+(" [as "+q+"]"))}else j=j+(q||"<anonymous>")}else if(s)j=j+("new "+(k||"<anonymous>"));else if(k)j=j+k;else{j=j+p;r=false}r&&(j=j+(" ("+p+")"));g=j}catch(u){try{g="<error: "+u+">"}catch(v){g="<error>"}}e.push("    at "+
g)}}g=e.join("\n");b.stack=g}throw b;})})};c.timeout=function(a,b){var c=i();f(a,c.resolve,c.reject);setTimeout(function(){c.reject(Error("Timed out after "+b+"ms"))},b);return c.promise};c.delay=function(a,b){if(b===void 0){b=a;a=void 0}var c=i();setTimeout(function(){c.resolve(a)},b);return c.promise};c.napply=y;c.ncall=function(a,b){var c=e(arguments,2);return y(a,b,c)};c.nbind=M;c.npost=function(a,b,c){return y(a[b],b,c)};c.ninvoke=function(a,b){var c=e(arguments,2);return y(a[b],b,c)};q(c)});
